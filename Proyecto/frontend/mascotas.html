<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Mascotas - Dejando Huella</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
  <header class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto">
        <h1 class="sitename">Dejando Huella</h1>
      </a>
      <nav class="navmenu">
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="mascotas.html">Mascotas</a></li>
          <li><a href="eventos.html">Eventos</a></li>
          <li><a href="campanias.html" class="active">Campañas</a></li>
          <li><a href="inventarios.html" class="active">Inventarios</a></li>
          <li><a href="voluntarios.html">Voluntarios</a></li>
          <li><a class="btn btn-primary btn-sm text-white" href="register.html">Registro</a></li>
          <li><a class="btn btn-success btn-sm text-white" href="login.html">Login</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container py-5">
    <h2 class="text-center mb-4">Mascotas</h2>

    <div class="mb-4 text-right">
      <a href="crearMascotas.html" class="btn btn-success"><i class="fas fa-bullhorn"></i> Registrar Mascota</a>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="thead-dark">
          <tr>
            <th>ID</th>
            <th>Nombre de la Mascota</th>
            <th>Raza</th>
            <th>Edad</th>
            <th>Descripción</th>
            <th>Foto</th>
            <th>Estado</th>
            <th>Usuario</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="mascotasTable"></tbody>
      </table>
    </div>
  </main>

  <script>
fetch('/api/mascotas')
  .then(res => res.json())
  .then(mascotas => {
    const tbody = document.querySelector('#mascotasTable');
    mascotas.forEach(m => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${m[0]}</td>
        <td>${m[1]}</td>
        <td>${m[2]}</td>
        <td>${m[3]}</td>
        <td>${m[4]}</td>
        <td>
          <img src="${m[5] && m[5].trim() !== '' ? m[5] : 'img/placeholder.png'}" 
               alt="${m[0]}" 
               width="100">
        </td>
        <td>${m[6]}</td>
        <td>${m[7]}</td>
        <td>
          <button class="btn btn-primary btn-sm editar-btn" data-id="${m[0]}">
            <i class="fas fa-edit"></i> Editar
          </button>
          <button class="btn btn-danger btn-sm eliminar-btn" data-id="${m[0]}">
            <i class="fas fa-trash-alt"></i> Eliminar
          </button>
          <button class="btn btn-info btn-sm categoria-btn" data-edad="${m[3]}">
            Categoría
          </button>
          <button class="btn btn-warning btn-sm estado-btn" data-id="${m[0]}">
            Estado
          </button>
          <button class="btn btn-secondary btn-sm historial-btn" data-id="${m[0]}">
            Historial
          </button>
        </td>
      `;
      tbody.appendChild(row);
    });
  })
  .catch(err => console.error('Error al cargar mascotas:', err));

// Event delegation para los botones de la tabla
document.querySelector('#mascotasTable').addEventListener('click', (e) => {
  const button = e.target.closest('button');
  if (!button) return;

  const id = button.dataset.id;
  const edad = button.dataset.edad;

  // Botón eliminar
  if (button.classList.contains('eliminar-btn')) {
    if (confirm('¿Seguro que deseas eliminar esta mascota?')) {
      fetch(`/api/mascotas/${id}`, { method: 'DELETE' })
        .then(res => {
          if (res.ok) location.reload();
          else alert('No se pudo eliminar la mascota');
        })
        .catch(err => console.error('Error al eliminar mascota:', err));
    }
  }

  // Botón editar
  if (button.classList.contains('editar-btn')) {
    window.location.href = `editarMascota.html?id=${id}`;
  }

  // Botón categoría por edad
  if (button.classList.contains('categoria-btn')) {
    fetch(`/api/mascotas/${edad}/categoria`)
      .then(res => res.json())
      .then(data => alert(`Categoría: ${data.categoria || JSON.stringify(data)}`))
      .catch(err => console.error('Error al obtener categoría:', err));
  }

  // Botón estado
  if (button.classList.contains('estado-btn')) {
    fetch(`/api/mascotas/${id}/estado`)
      .then(res => res.json())
      .then(data => alert(`Estado: ${data.estado || JSON.stringify(data)}`))
      .catch(err => console.error('Error al obtener estado:', err));
  }

  // Botón historial
  if (button.classList.contains('historial-btn')) {
    fetch(`/api/mascotas/${id}/historial`)
      .then(res => res.json())
      .then(data => alert(`Historial: ${JSON.stringify(data)}`))
      .catch(err => console.error('Error al obtener historial:', err));
  }
});
</script>


  <footer class="text-center py-3 bg-light">
    <p>&copy; 2025 Dejando Huella. Todos los derechos reservados.</p>
  </footer>

</body>

</html>